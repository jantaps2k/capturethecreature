var _gamePlay={isPlaying:false,score:0,myGuess:[],level:3,target:null,gameLayer:null,playerStats:{allowableClicks:3,initPlayerStats:function(){}},startPlaying:function(){this.isPlaying=true},stopPlaying:function(){this.isPlaying=false},startGame:function(e){var t=e.targetNode.getParent().getParent(),n=t.find("#GAME_TIMER_TXT")[0];console.log(t);console.log("noop");setTimeout(function(){_gamePlay.startPlaying();_gamePlay.gameTimer.start(n,t);_animation.updateGameGridCharacters(_board.board,t)},1e3);this.target=_gamePlay.getRandomCharacter(0);_board.shuffleBoard(this.target,this.level)},getRandomCharacter:function(e){var t=_characters.length;var n;do{n=Math.floor(Math.random()*t)}while(n==e);return n},addToGuess:function(e){this.myGuess.push(e)},removeFromGuess:function(e){var t=this.myGuess.indexOf(e);this.myGuess.splice(t,1)},updateMyGuess:function(e){if(this.myGuess.indexOf(e)==-1){this.addToGuess(e);if(this.myGuess.length==this.playerStats.allowableClicks){var t=this.myGuess.map(function(e){return parseInt(e,10)});this.myGuess=t;return true}else{return false}}else{this.removeFromGuess(e);return false}},gameTimer:{time:121,timer:null,start:function(e,t){this.timer=setInterval(function(){_gamePlay.gameTimer.tiktok(e,t)},1e3)},stop:function(){if(this.timer!=null){clearInterval(this.timer);this.timer=null}_gamePlay.stopPlaying()},tiktok:function(e,t){this.time--;this.updateToGUI(this.showInFormat(this.time),e,t);if(this.time==0){this.stop()}},showInFormat:function(e){var t=Math.floor(e/60)+":";if(e%60<10){t+="0"}return t+e%60+""},updateToGUI:function(e,t,n){t.text(e);n.draw();_animation.updateTimerBar(n)}}};var __player={_data:{name:"Player Name",score:0,fbToken:null},getPlayerName:function(){return __player._data.name},setPlayerName:function(e){this._data.name=e}};var _fb={fb:null,ifFbLogin:function(){if(this.fb==null){return false}else{return true}},init:function(){}};var _board={board:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],printBoard:function(){var e="";for(var t=0;t<this.boardSize();t++){e+=this.board[t];if((t+1)%4==0&&t!=0){e+="\n"}}console.log(e)},boardSize:function(){return this.board.length},assignToBoard:function(e,t){this.board[e]=t},cleanBoard:function(){for(var e=0;e<this.boardSize();e++){this.assignToBoard(e,0)}},shuffleBoard:function(e,t){var n=[];var r=t;var i=0;this.cleanBoard();for(var s=0;s<r;s++){do{var o=this.boardSize();i=Math.floor(Math.random()*o)}while(n.indexOf(i)!=-1);console.log("Has new place! At "+i);this.assignToBoard(i,e);n[s]=i}for(var u=0;u<this.boardSize();u++){var a=9;if(n.indexOf(u)==-1){this.assignToBoard(u,a)}}this.printBoard();return this.board},checkIfGuessCorrect:function(e,t){console.log("Checking "+e+" for obj:"+t);var n=true,r=this.board;var i=e.sort(),s;while(n&&e.length>0){s=e.pop();if(r[s]!=t){n=false}}return n},addUpToScore:function(e,t){}};var _characters=[{name:"NONE",value:0,img:"path_to_image/here"},{name:"Cheekee",value:10,img:"path_to_image/here"},{name:"Chaakee",value:12,img:"path_to_image/here"},{name:"Chuukee",value:12,img:"path_to_image/here"}];var _player={level:1,storePlayerData:function(){},getFBCredentials:function(e,t){}};var _app={app:null,screens:[],resources:{__init:function(){console.log("Loading resources...");this.mainMenuBackground=new Image;this.mainMenuBackground.src="img/BG.png";this.gameScreenBackground=new Image;this.gameScreenBackground.src="img/gameBG.png"},mainMenuBackground:null,gameScreenBackground:null},__init__:function(){var e=window,t=document,n=t.documentElement,r=t.getElementsByTagName("body")[0];var i=e.innerWidth||n.clientWidth||r.clientWidth,s=e.innerHeight||n.clientHeight||r.clientHeight;this.app=new Kinetic.Stage({container:"gameContainer",width:i,height:s});console.log(i+" x "+s);var o=this.initMainGameLayer(i,s);this.app.add(o);this.screens=[o]},appWidth:function(){return this.app.width()},appHeight:function(){return this.app.height()},initMainGameLayer:function(e,t){var n=new Kinetic.Layer({width:e,height:t*2,x:0,y:0,id:"GAME_LAYER"}),r=this.initMainMenuScreen(e,t),i=this.initGameScreen(e,t);n.add(r);n.add(i);return n},initMainMenuScreen:function(e,t){var n=new Kinetic.Group({width:e,height:t,x:0,y:0,id:"MAIN_MENU_PAGE"});var r=new Kinetic.Image({image:this.resources.mainMenuBackground,width:n.width(),height:n.height()});n.add(r);var i=new Kinetic.Rect({width:n.width()*.6,height:n.width()*.1,x:n.width()*.2,y:n.height()*.7,fill:"#68b646",cornerRadius:n.width()*.03,stroke:"#c3da42",fillLinearGradientStartPoint:{x:-50,y:-50},fillLinearGradientEndPoint:{x:50,y:50},fillLinearGradientColorStops:[0,"red",300,"yellow"]});i.on("touchstart",function(e){var t=e.targetNode;t.fill("#c3da42");t.draw()}).on("touchend",function(e){var t=e.targetNode;t.fill("#68b646");t.draw();_animation.slideMainMenuUp();_gamePlay.startGame(e)});n.add(i);return n},initGameScreen:function(e,t){var n=new Kinetic.Group({width:e,height:t,x:0,y:t,id:"GAME_SCREEN"});var r=new Kinetic.Image({image:this.resources.gameScreenBackground,width:n.width(),height:n.height()});n.add(r);var i=this.initGameStatsScreen(e,t);n.add(i);var s=this.initGameGrid(e,t,i.y()+i.height()+5);n.add(s);return n},initGameGrid:function(e,t,n){var r=new Kinetic.Group({width:e,height:t,x:0,y:n});var i={w:4,h:5,x:e*.1,y:0,width:e*.8/4,height:t*.7/5},s={};var o;var u;var a;var f=0;for(var l=0;l<i.h;l++){for(var c=0;c<i.w;c++){o=new Kinetic.Group({name:"GAME_GRID_ELEM",id:f,x:i.x,y:i.y,width:i.width,height:i.height});a=new Kinetic.Rect({stroke:"black",x:0,y:0,width:i.width,height:i.height});o.add(a);content=new Kinetic.Text({text:" --- ",fontSize:24,fontFamily:"Calibri",fill:"#29230b",x:0,y:0});o.add(content);o.on("touchstart",function(e){}).on("touchend",function(e){var t=e.targetNode.getParent(),n,r,i;if(_gamePlay.isPlaying){n=t.id();i=_gamePlay.updateMyGuess(n);if(i){_animation.clearClickedInteractions(t,_gamePlay.myGuess);r=_board.checkIfGuessCorrect(_gamePlay.myGuess,_gamePlay.target);if(r){console.log("Correct guess!");_gamePlay.target=_gamePlay.getRandomCharacter(0);_board.shuffleBoard(_gamePlay.target,_gamePlay.level);_animation.updateGameGridCharacters(_board.board,t.getLayer())}else{console.log("Wrong guess!")}_gamePlay.myGuess=[]}else{t.children[0].fill("rgba(0,255,0,0.4");t.getLayer().draw()}}else{console.log("You're not playing, mate...")}});r.add(o);f++;i.x+=i.width}i.x=e*.1;i.y+=i.height}return r},initClickableGrid:function(e,t,n){var r=new Kinetic.Group({width:e*.8,height:t*.8,x:e*.1,y:t*.1});var i=null;var s=0;var o={width:r.width()/n.w,height:r.height()/n.h,x:0,y:0};for(var t=0;t<n.h;t++){o.x=0;for(var e=0;e<n.w;e++){i=new Kinetic.Rect(o);i.id(s);s++;i.stroke("rgba(0,255,0,0.2");i.fill("rgba(0,255,0,0.3");i.on("touchstart",function(e){console.log("mousedown a grid elem");var t=e.targetNode}).on("touchend",function(e){console.log("mouseup a grid elem");var t=e.targetNode;t.setFill("blue");t.draw();console.log(t.id());if(_gamePlay.myGuess.indexOf(t.id())==-1){_gamePlay.addToGuess(t.id());if(_gamePlay.myGuess.length==_gamePlay.playerStats.allowableClicks){console.log(_gamePlay.myGuess);_gamePlay.myGuess=[]}}else{}});r.add(i);o.x+=o.width}o.y+=o.height}return r},initCharacterGrid:function(e,t,n){var r=new Kinetic.Group({width:e*.8,height:t*.8,x:e*.15,y:t*.1});var i=null;var s=e*.025;var o={width:r.width()/n.w-s,height:r.height()/n.h-s,x:0,y:s*3};var u,a;for(var t=0;t<n.h;t++){o.x=0;for(var e=0;e<n.w;e++){i=new Kinetic.Group(o);a=new Kinetic.Rect({width:r.width()/n.w-s,height:r.height()/n.h-s});u=new Kinetic.Text({text:"0",fontSize:30,fontFamily:"Calibri",fill:"black",name:"CHARACTER_GRID_TXT"});a.stroke("black");i.add(a);i.add(u);r.add(i);o.x+=o.width}o.y+=o.height}return r},updateCharacterGrid:function(e){var t=this.screens[0].find(".CHARACTER_GRID_TXT");for(var n=0;n<t.length;n++){t[n].text(e[n]);t[n].fill("red");t[n].getParent().draw();console.log(t[n].text())}},initGameStatsScreen:function(e,t){var n=new Kinetic.Group({width:e+4,height:t*.12,x:0,y:t*.05});var r=new Kinetic.Rect({width:n.width(),height:n.height()*1,x:-2,y:0,fill:"#ac7441",stroke:"#29230b",strokeWidth:3});n.add(r);var i=new Kinetic.Text({text:"0:00",fontSize:24,fontFamily:"Calibri",fill:"#29230b",id:"GAME_TIMER_TXT",x:5,y:2});n.add(i);var s=new Kinetic.Text({text:"00000",fontSize:24,fontFamily:"Calibri",fill:"#29230b",id:"GAME_SCORE_TXT",align:"right",x:n.width()-70,y:2});n.add(s);var o=new Kinetic.Rect({x:6,y:i.height()+7,height:5,width:n.width()*.95,fill:"#ac7441",stroke:"#29230b"});n.add(o);var u=new Kinetic.Rect({x:6,y:i.height()+7,height:5,width:o.width(),fill:"#29230b",stroke:"#29230b",id:"TIMER_BAR"});n.add(u);_animation.timerBarOffset=u.width()/121;return n}};var _animation={timerTextObject:null,timerBarOffset:null,counter:0,slideMainMenuUp:function(){var e=_app.screens[0].find("#MAIN_MENU_PAGE")[0],t=_app.screens[0].find("#GAME_SCREEN")[0];var n=new Kinetic.Animation(function(n){e.y(e.y()-18);t.y(t.y()-18);e.draw();t.draw();if(t.y()<0){this.stop()}},_app.screens[0]);var r=new Kinetic.Animation(function(r){var i=e.height()*.1;e.y(e.y()+3);t.y(t.y()+3);e.draw();t.draw();if(i<e.y()){this.stop();n.start()}},_app.screens[0]);r.start()},enlargeButton:function(e){var t=e;t.width(t.width()+t.width()*.2);t.height(t.height()+t.height()*.2);t.x(t.x()-t.width()*.1);return t},shrinkButton:function(e){var t=e;t.width(t.width()-t.width()*.166666666666666);t.height(t.height()-t.height()*.166666666666666);t.x(t.x()+t.width()*.01);return t},updateTimerBar:function(e){var t=e.find("#TIMER_BAR")[0];t.width(t.width()-this.timerBarOffset);e.draw()},updateGameGridCharacters:function(e,t){var n=t.find(".GAME_GRID_ELEM"),r;for(var i=0;i<e.length;i++){r=n[i].children[1];r.text(e[i])}t.draw()},clearClickedInteractions:function(e,t){var n=e.getLayer(),r=n.find(".GAME_GRID_ELEM"),i;console.log("Clearing clicked interactions..."+t);for(var s=0;s<r.length;s++){if(t.indexOf(r[s].id())!=-1){r[s].children[0].fill("rgba(0,255,0,0.0")}}n.draw()}};var _gameScreen={_screen:new Kinetic.Layer({id:"GAME_SCREEN"}),gameGrid:{layer:new Kinetic.Group,gridSlotOffset:{left:.1,right:.1,top:.1,bottom:.1},gridSlotAttr:{x:0,y:0,width:60,height:60,id:null,fill:"green",stroke:"black",strokeWidth:1},gridSize:{h:4,v:5},initializeGridClickable:function(){var e=new Kinetic.Group;this.gridSlotAttr.x=20;this.gridSlotAttr.y=20;var t,n=0;for(var r=0;r<this.gridSize.v;r++){for(var i=0;i<this.gridSize.h;i++){this.gridSlotAttr.id="GAME_SLOT_"+n;t=new Kinetic.Rect(this.gridSlotAttr);t.on("mouseup",function(){console.log(this.id())}).on("mouseover",function(){this.fill="blue"});e.add(t);n++;this.gridSlotAttr.x+=this.gridSlotAttr.width}this.gridSlotAttr.y+=this.gridSlotAttr.height;this.gridSlotAttr.x=20}this.layer=e}},initAttach_ClickableGrid:function(){this.gameGrid.initializeGridClickable();this._screen.add(this.gameGrid.layer)}};var __cordova={init:function(){}};_app.resources.__init();window.onload=function(){console.log("Starting application...!");_app.__init__()}